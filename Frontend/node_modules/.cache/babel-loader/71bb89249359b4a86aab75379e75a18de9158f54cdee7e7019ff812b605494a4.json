{"ast":null,"code":"import _objectSpread from\"c:/Users/DELL/Desktop/Yasin Heaven Star Hotel/Frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useState}from'react';import DatePicker from'react-datepicker';import'react-datepicker/dist/react-datepicker.css';import{FaBed,FaCalendarAlt,FaCheckCircle,FaCreditCard,FaUser,FaUsers,FaWifi}from'react-icons/fa';import{useNavigate}from'react-router-dom';import{authUtils,bookingAPI,roomAPI}from'../services/api';import'./BookRoomPage.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const BookRoomPage=()=>{const[rooms,setRooms]=useState([]);const[selectedRoom,setSelectedRoom]=useState(null);const[checkInDate,setCheckInDate]=useState(new Date());const[checkOutDate,setCheckOutDate]=useState(new Date(Date.now()+86400000));// Tomorrow\nconst[guests,setGuests]=useState(1);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const[step,setStep]=useState(1);// 1: Select Room, 2: Fill Details, 3: Confirmation\nconst[isAuthenticated,setIsAuthenticated]=useState(false);const[customerInfo,setCustomerInfo]=useState({name:'',email:'',phone:'',specialRequests:''});const navigate=useNavigate();useEffect(()=>{checkAuthentication();fetchAvailableRooms();},[]);useEffect(()=>{fetchAvailableRooms();},[checkInDate,checkOutDate]);const checkAuthentication=()=>{const token=authUtils.getToken();const userType=localStorage.getItem('userType');if(token&&userType==='user'){setIsAuthenticated(true);// Pre-fill user info if available\nconst userInfo=localStorage.getItem('userInfo');if(userInfo){const user=JSON.parse(userInfo);setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{name:user.name||'',email:user.email||''}));}}else{setIsAuthenticated(false);}};const fetchAvailableRooms=async()=>{try{setLoading(true);setError('');const checkIn=checkInDate.toISOString().split('T')[0];const checkOut=checkOutDate.toISOString().split('T')[0];const response=await roomAPI.getAllRooms();// Filter available rooms (you could also pass dates to API)\nconst availableRooms=response.data.filter(room=>room.status==='available');setRooms(availableRooms);}catch(err){setError('Failed to fetch rooms. Please try again.');console.error('Error fetching rooms:',err);}finally{setLoading(false);}};const calculateNights=()=>{const diffTime=Math.abs(checkOutDate-checkInDate);return Math.ceil(diffTime/(1000*60*60*24));};const calculateTotal=()=>{if(!selectedRoom)return 0;return selectedRoom.price*calculateNights();};const handleRoomSelect=room=>{setSelectedRoom(room);setStep(2);};const handleBookingSubmit=async e=>{e.preventDefault();if(!isAuthenticated){localStorage.setItem('redirectAfterLogin','/book-room');navigate('/login');return;}if(!selectedRoom){setError('Please select a room');return;}setLoading(true);setError('');try{const bookingData={room:selectedRoom._id,checkIn:checkInDate.toISOString().split('T')[0],checkOut:checkOutDate.toISOString().split('T')[0],guests,customerInfo};const response=await bookingAPI.createBooking(bookingData);if(response.data){setSuccess('Booking created successfully!');setStep(3);// Reset form after successful booking\nsetTimeout(()=>{navigate('/booking');},3000);}}catch(err){var _err$response,_err$response$data;console.error('Booking error:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to create booking. Please try again.');}finally{setLoading(false);}};const handleInputChange=e=>{const{name,value}=e.target;setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};// Step 1: Room Selection\nif(step===1){return/*#__PURE__*/_jsx(\"div\",{className:\"booking-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"booking-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Book Your Room\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Select your preferred dates and room type\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-selection\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"date-picker-group\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(FaCalendarAlt,{}),\" Check-in Date\",/*#__PURE__*/_jsx(DatePicker,{selected:checkInDate,onChange:setCheckInDate,minDate:new Date(),dateFormat:\"yyyy-MM-dd\",className:\"date-input\"})]}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(FaCalendarAlt,{}),\" Check-out Date\",/*#__PURE__*/_jsx(DatePicker,{selected:checkOutDate,onChange:setCheckOutDate,minDate:checkInDate,dateFormat:\"yyyy-MM-dd\",className:\"date-input\"})]}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(FaUsers,{}),\" Guests\",/*#__PURE__*/_jsx(\"select\",{value:guests,onChange:e=>setGuests(parseInt(e.target.value)),className:\"guests-select\",children:[1,2,3,4,5,6].map(num=>/*#__PURE__*/_jsxs(\"option\",{value:num,children:[num,\" Guest\",num>1?'s':'']},num))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"booking-summary\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:calculateNights()}),\" night\",calculateNights()>1?'s':'']}),/*#__PURE__*/_jsxs(\"p\",{children:[checkInDate.toLocaleDateString(),\" - \",checkOutDate.toLocaleDateString()]})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"room-grid\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading available rooms...\"}):rooms.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"no-rooms\",children:\"No rooms available for selected dates\"}):rooms.map(room=>/*#__PURE__*/_jsxs(\"div\",{className:\"room-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"room-image\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/assets/Rooms/\".concat(room.type.replace(' ','%20'),\"%201.jpg\"),alt:room.type,onError:e=>{e.target.src='/assets/Home%201.jpg';}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:room.type}),/*#__PURE__*/_jsxs(\"p\",{className:\"room-number\",children:[\"Room \",room.number]}),/*#__PURE__*/_jsx(\"p\",{className:\"room-description\",children:room.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-features\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(FaWifi,{}),\" WiFi\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(FaBed,{}),\" \",room.bedType||'Comfortable Bed']}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(FaUser,{}),\" Up to \",room.capacity||2,\" guests\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-pricing\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"price\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"amount\",children:[\"$\",room.price]}),/*#__PURE__*/_jsx(\"span\",{className:\"period\",children:\"per night\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"total\",children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"Total: $\",room.price*calculateNights()]})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRoomSelect(room),className:\"btn btn-primary select-room-btn\",children:\"Select This Room\"})]})]},room._id))})]})});}// Step 2: Customer Details\nif(step===2){return/*#__PURE__*/_jsx(\"div\",{className:\"booking-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"booking-progress\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"step completed\",children:\"1. Select Room\"}),/*#__PURE__*/_jsx(\"div\",{className:\"step active\",children:\"2. Guest Details\"}),/*#__PURE__*/_jsx(\"div\",{className:\"step\",children:\"3. Confirmation\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"booking-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selected-room-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Selected Room\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-summary-card\",children:[/*#__PURE__*/_jsxs(\"h4\",{children:[selectedRoom.type,\" - Room \",selectedRoom.number]}),/*#__PURE__*/_jsx(\"p\",{children:selectedRoom.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"booking-dates\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Check-in:\"}),\" \",checkInDate.toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Check-out:\"}),\" \",checkOutDate.toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Nights:\"}),\" \",calculateNights()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Guests:\"}),\" \",guests]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"total-amount\",children:/*#__PURE__*/_jsxs(\"h4\",{children:[\"Total Amount: $\",calculateTotal()]})})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleBookingSubmit,className:\"customer-form\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Guest Information\"}),!isAuthenticated&&/*#__PURE__*/_jsxs(\"div\",{className:\"auth-notice\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"You need to be logged in to complete the booking.\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{localStorage.setItem('redirectAfterLogin','/book-room');navigate('/login');},className:\"btn btn-primary\",children:\"Login to Continue\"})]}),isAuthenticated&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Full Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",value:customerInfo.name,onChange:handleInputChange,required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email Address *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",value:customerInfo.email,onChange:handleInputChange,required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Phone Number *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"phone\",value:customerInfo.phone,onChange:handleInputChange,required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Special Requests (Optional)\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"specialRequests\",value:customerInfo.specialRequests,onChange:handleInputChange,rows:\"3\",className:\"form-input\",placeholder:\"Any special requests or preferences...\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setStep(1),className:\"btn btn-secondary\",children:\"Back to Rooms\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"btn btn-primary\",children:loading?'Processing...':'Confirm Booking'})]})]})]})]})]})});}// Step 3: Confirmation\nif(step===3){return/*#__PURE__*/_jsx(\"div\",{className:\"booking-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"booking-confirmation\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"success-icon\",children:/*#__PURE__*/_jsx(FaCheckCircle,{})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Booking Confirmed!\"}),/*#__PURE__*/_jsx(\"p\",{children:success}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Booking Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-card\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Room:\"}),\" \",selectedRoom.type,\" - Room \",selectedRoom.number]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Guest:\"}),\" \",customerInfo.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),\" \",customerInfo.email]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Phone:\"}),\" \",customerInfo.phone]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Check-in:\"}),\" \",checkInDate.toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Check-out:\"}),\" \",checkOutDate.toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Guests:\"}),\" \",guests]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Amount:\"}),\" $\",calculateTotal()]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-actions\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/booking'),className:\"btn btn-primary\",children:[/*#__PURE__*/_jsx(FaCreditCard,{}),\" View My Bookings\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),className:\"btn btn-secondary\",children:\"Back to Home\"})]})]})})});}};export default BookRoomPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}